# vim: set ft=yaml:
# yaml-language-server: $schema=values.schema.json

# @schema
# type: integer
# minimum: 1
# @schema
# -- Number of replicas to deploy
replicaCount: 1

# @schema
# additionalProperties: true
# @schema
image:
  # @schema
  # type: string
  # @schema
  # -- Container image repository (e.g. docker.io/user/image)
  repository: timmi6790/cloudflare-access-webhook-redirect

  # @schema
  # type: string
  # @schema
  # -- Container image tag (version)
  tag: v0.3.11@sha256:d3df58915085a59e6fa4a503f092d1d18df4d0c481a0db0013183456f8b0aa9a

  # @schema
  # enum: [Always, IfNotPresent, Never]
  # @schema
  # -- Image pull policy
  pullPolicy: IfNotPresent

# @schema
# type: array
# @schema
# -- Optional image pull secrets for private registries
imagePullSecrets: []

# @schema
# type: string
# @schema
# -- Override the chart name
nameOverride: ""

# @schema
# type: string
# @schema
# -- Override the full release name
fullnameOverride: ""

# @schema
# additionalProperties: true
# @schema
serviceAccount:
  # @schema
  # type: boolean
  # @schema
  # -- Whether to create a dedicated service account
  create: true

  # @schema
  # type: object
  # additionalProperties: true
  # @schema
  # -- Additional annotations for the service account
  annotations: {}

  # @schema
  # type: string
  # @schema
  # -- Custom service account name (auto-generated if empty)
  name: ""

  # @schema
  # type: boolean
  # @schema
  # -- Whether to automount the service account token
  automountToken: false

# @schema
# type: string
# @schema
# -- Optional Kubernetes PriorityClass name
priorityClassName: ""

# @schema
# type: object
# additionalProperties: true
# @schema
# -- Additional annotations for the Pod metadata
podAnnotations: {}

# @schema
# type: object
# additionalProperties: true
# @schema
# -- Additional labels for the Pod metadata
podLabels: {}

# @schema
# $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.PodSecurityContext"
# @schema
podSecurityContext:
  # -- Run pod as non-root user
  runAsNonRoot: true

  # -- User ID to run as
  runAsUser: 10001

  # -- Group ID for file system access
  fsGroup: 10001

# @schema
# $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.SecurityContext"
# @schema
securityContext:
  # -- Allow privilege escalation
  allowPrivilegeEscalation: false

  capabilities:
    # -- Linux capabilities to drop
    drop:
      - ALL

  # -- Mount root filesystem as read-only
  readOnlyRootFilesystem: false

# @schema
# additionalProperties: true
# @schema
application:
  # @schema
  # enum: [debug, info, warn, error]
  # @schema
  # -- Application log level
  logLevel: info

  # @schema
  # type: string
  # @schema
  # -- Sentry DSN for error tracking (empty disables)
  sentryDsn: ""

  # @schema
  # additionalProperties: true
  # @schema
  server:
    # @schema
    # type: integer
    # @schema
    # -- HTTP server port
    port: 8080

    # @schema
    # type: string
    # @schema
    # -- Server bind address
    host: 0.0.0.0

  # @schema
  # additionalProperties: true
  # @schema
  handler:
    # @schema
    # type: string
    # @schema
    # -- Base URL for redirect targets
    targetBase: ""

    # @schema
    # type: object
    # additionalProperties:
    #   type: array
    #   items:
    #     type: string
    # @schema
    # -- Path configurations with allowed HTTP methods
    # Example:
    #   api/webhook:
    #     - ALL
    #   test:
    #     - GET
    #     - POST
    paths: {}

  # @schema
  # additionalProperties: true
  # @schema
  cloudflareAccess:
    # @schema
    # type: string
    # @schema
    # -- Existing secret name containing Cloudflare Access credentials
    # Must contain client_id and client_secret keys
    secretName: ""

    # @schema
    # type: [string, "null"]
    # @schema
    # -- Optional client ID (alternative to secretName)
    # clientId: ""

    # @schema
    # type: [string, "null"]
    # @schema
    # -- Optional client secret (alternative to secretName)
    # clientSecret: ""

# @schema
# additionalProperties: true
# @schema
service:
  # @schema
  # enum: [ClusterIP, NodePort, LoadBalancer]
  # @schema
  # -- Kubernetes service type
  type: ClusterIP

  # @schema
  # type: integer
  # @schema
  # -- Service port
  port: 80

  # @schema
  # type: object
  # additionalProperties: true
  # @schema
  # -- Additional service annotations
  annotations: {}

# @schema
# additionalProperties: true
# @schema
ingress:
  # @schema
  # type: boolean
  # @schema
  # -- Enable ingress resource
  enabled: false

  # @schema
  # type: string
  # @schema
  # -- Ingress class name (e.g. nginx)
  ingressClassName: "nginx"

  # @schema
  # type: object
  # additionalProperties: true
  # @schema
  # -- Additional ingress annotations
  # Example:
  #   cert-manager.io/cluster-issuer: letsencrypt-prod
  #   nginx.ingress.kubernetes.io/rate-limit: "100"
  annotations: {}

  # @schema
  # type: array
  # @schema
  # -- Host definitions for ingress
  # Example:
  #   - host: example.local
  #     paths:
  #       - path: /
  #         pathType: Prefix
  hosts: []

  # @schema
  # type: array
  # items:
  #   $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.networking.v1.IngressTLS"
  # @schema
  # -- TLS configuration for ingress
  # Example:
  #   - secretName: example-tls
  #     hosts:
  #       - example.local
  tls: []

# @schema
# $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.ResourceRequirements"
# @schema
resources:
  # -- Resource limits
  limits:
    # -- Maximum CPU usage (e.g. 100m = 0.1 core)
    cpu: 100m

    # -- Maximum memory usage (e.g. 64Mi)
    memory: 50Mi

  # -- Resource requests
  requests:
    # -- Guaranteed CPU request
    cpu: 10m

    # -- Guaranteed memory request
    memory: 35Mi

# @schema
# allOf:
#   - $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.Probe"
#   - properties:
#       enabled:
#         type: boolean
# @schema
startupProbe:
  # -- Enable startup probe
  enabled: true

  httpGet:
    # -- Health check path
    path: /health

    # -- Health check port
    port: http

  # -- Initial delay before probe starts
  initialDelaySeconds: 2

  # -- Probe frequency
  periodSeconds: 5

  # -- Probe timeout
  timeoutSeconds: 3

  # -- Failure threshold
  failureThreshold: 30

  # -- Success threshold
  successThreshold: 1

# @schema
# allOf:
#   - $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.Probe"
#   - properties:
#       enabled:
#         type: boolean
# @schema
livenessProbe:
  # -- Enable liveness probe
  enabled: true

  httpGet:
    # -- Health check path
    path: /health

    # -- Health check port
    port: http

  # -- Initial delay before probe starts
  initialDelaySeconds: 10

  # -- Probe frequency
  periodSeconds: 10

  # -- Probe timeout
  timeoutSeconds: 5

  # -- Failure threshold
  failureThreshold: 3

# @schema
# allOf:
#   - $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.Probe"
#   - properties:
#       enabled:
#         type: boolean
# @schema
readinessProbe:
  # -- Enable readiness probe
  enabled: true

  httpGet:
    # -- Health check path
    path: /health

    # -- Health check port
    port: http

  # -- Initial delay before probe starts
  initialDelaySeconds: 5

  # -- Probe frequency
  periodSeconds: 5

  # -- Probe timeout
  timeoutSeconds: 3

  # -- Failure threshold
  failureThreshold: 3

# @schema
# additionalProperties: true
# @schema
autoscaling:
  # @schema
  # type: boolean
  # @schema
  # -- Enable Horizontal Pod Autoscaler (HPA)
  enabled: false

  # @schema
  # type: integer
  # minimum: 1
  # @schema
  # -- Minimum replicas
  minReplicas: 1

  # @schema
  # type: integer
  # minimum: 1
  # @schema
  # -- Maximum replicas
  maxReplicas: 5

  # @schema
  # type: integer
  # minimum: 1
  # maximum: 100
  # @schema
  # -- Target CPU utilization (%)
  targetCPUUtilizationPercentage: 80

  # @schema
  # type: integer
  # minimum: 1
  # maximum: 100
  # @schema
  # -- Target memory utilization (%)
  targetMemoryUtilizationPercentage: 80

# @schema
# type: array
# items:
#   $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.TopologySpreadConstraint"
# @schema
# -- Pod topology spread constraints for availability
topologySpreadConstraints: []

# @schema
# type: array
# items:
#   $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.Volume"
# @schema
# -- Additional volumes (e.g., cache, tmp)
volumes: []

# @schema
# type: array
# items:
#   $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.VolumeMount"
# @schema
# -- Additional volume mounts (e.g., /cache)
volumeMounts: []

# @schema
# type: object
# additionalProperties: true
# @schema
# -- Node selector labels for scheduling
nodeSelector: {}

# @schema
# type: array
# items:
#   $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.Toleration"
# @schema
# -- Tolerations for taints
tolerations: []

# @schema
# $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.core.v1.Affinity"
# @schema
# -- Pod affinity rules
affinity: {}

# @schema
# additionalProperties: true
# @schema
podDisruptionBudget:
  # @schema
  # type: boolean
  # @schema
  # -- Enable PodDisruptionBudget
  enabled: false

  # @schema
  # type: [integer, "null"]
  # @schema
  # -- Minimum available pods
  minAvailable: 1

  # @schema
  # type: [integer, "null"]
  # @schema
  # -- Maximum unavailable pods
  maxUnavailable: 1

# @schema
# additionalProperties: true
# @schema
# -- Network policy configuration
networkPolicy:
  # @schema
  # type: boolean
  # @schema
  # -- Enable network policies
  enabled: false

  # @schema
  # additionalProperties: true
  # @schema
  # -- Ingress configuration
  ingress:
    # @schema
    # type: boolean
    # @schema
    # -- Enable ingress rules
    enabled: true

    # @schema
    # additionalProperties: true
    # @schema
    # -- Monitoring configuration for ingress
    monitoring:
      # @schema
      # type: boolean
      # @schema
      # -- Allow ingress from monitoring namespace
      enabled: true
      
      # @schema
      # type: string
      # @schema
      # -- Namespace where monitoring tools are running
      namespace: monitoring

    # @schema
    # additionalProperties: true
    # @schema
    # -- Ingress Controller configuration
    controller:
      # @schema
      # type: boolean
      # @schema
      # -- Allow ingress from Ingress Controller
      enabled: true

      # @schema
      # type: string
      # @schema
      # -- Namespace where Ingress Controller is running (default: traefik)
      namespace: traefik

      # @schema
      # type: object
      # @schema
      # -- Pod selector for Ingress Controller (default: Traefik label)
      selector:
        app.kubernetes.io/name: traefik

    # @schema
    # type: array
    # items:
    #   type: object
    #   properties:
    #     ports:
    #       type: array
    #       items:
    #         $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.networking.v1.NetworkPolicyPort"
    #     from:
    #       type: array
    #       items:
    #         $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.networking.v1.NetworkPolicyPeer"
    # @schema
    # -- Custom ingress rules
    customRules: []

  # @schema
  # additionalProperties: true
  # @schema
  # -- Egress configuration
  egress:
    # @schema
    # type: boolean
    # @schema
    # -- Enable egress rules
    enabled: true

    # @schema
    # additionalProperties: true
    # @schema
    # -- DNS configuration for egress
    dns:
      # @schema
      # type: boolean
      # @schema
      # -- Allow egress to DNS
      enabled: true

    # @schema
    # additionalProperties: true
    # @schema
    # -- HTTP configuration for egress
    http:
      # @schema
      # type: boolean
      # @schema
      # -- Allow egress to HTTP (TCP/80)
      enabled: false

    # @schema
    # additionalProperties: true
    # @schema
    # -- HTTPS configuration for egress
    https:
      # @schema
      # type: boolean
      # @schema
      # -- Allow egress to HTTPS (TCP/443)
      enabled: false

    # @schema
    # additionalProperties: true
    # @schema
    # -- Sentry configuration for egress
    sentry:
      # @schema
      # type: boolean
      # @schema
      # -- Allow egress to Sentry (HTTPS)
      enabled: true

    # @schema
    # type: array
    # items:
    #   type: object
    #   properties:
    #     ports:
    #       type: array
    #       items:
    #         $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.networking.v1.NetworkPolicyPort"
    #     to:
    #       type: array
    #       items:
    #         $ref: "https://raw.githubusercontent.com/yannh/kubernetes-json-schema/master/v1.35.0/_definitions.json#/definitions/io.k8s.api.networking.v1.NetworkPolicyPeer"
    # @schema
    # Example: Allow access to a generic app
    # - ports:
    #     - port: 8080
    #       protocol: TCP
    #   to:
    #     - podSelector:
    #         matchLabels:
    #           app: my-generic-app
    # -- Custom egress rules
    customRules: []